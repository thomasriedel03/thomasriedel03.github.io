<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Invader</title>

    <style>
        canvas{
            background-color: rgba(0,0,0,0.8);
        }
    </style>

    <script>

        let KEY_SPACE = false; //32
        let KEY_UP = false; // 38
        let KEY_DOWN = false; //40
        let canvas;
        let ctx;
        let backgroundImage = new Image();
        

        let rocket = {

            x: 50,
            y: 200,
            width: 100, 
            height: 50, 
            src: "img/rocket.png"

        };

        let ufos = [];
        let missiles = [];


        document.onkeydown = function(e) {
            if (e.keyCode == 32){ // Leertaste gedrückt
                KEY_SPACE = true;
            }

            if (e.keyCode == 38){ // nach oben gedrückt
                KEY_UP = true;
            }

            if (e.keyCode == 40){ // nach unten gedrückt
                KEY_DOWN = true;
            }
        }

        document.onkeyup = function(e) {
            if (e.keyCode == 32){ // Leertaste losgelassen
                KEY_SPACE = false;
            }

            if (e.keyCode == 38){ // nach oben losgelassen
                KEY_UP = false;
            }

            if (e.keyCode == 40){ // nach unten losgelassen
                KEY_DOWN = false;
            }
        }

            function startGame(){

                canvas = document.getElementById("canvas")
                ctx = canvas.getContext ("2d");

                loadImages();
                setInterval(update, 1000 / 25);
                setInterval(createUfos, 5000);
                setInterval(checkForCollision, 1000 / 25);
                setInterval(checkForShoot, 1000 / 10);
                draw();
                //calculate
            
            }

            
           
            function checkForCollision(){

                ufos.forEach(function(ufo){
                    if(rocket.x + rocket.width > ufo.x &&
                     rocket.y + rocket.height > ufo.y &&
                     rocket.x < ufo.x &&
                     rocket.y < ufo.y 
                    ){
                        rocket.img.src = "img/explosion.png";
                        console.log("Collision!");
                        ufos = ufos.filter(u => u != ufo);

                    }
                
                missiles.forEach(function(missile){
                    if(
                        missile.x + missile.width > ufo.x &&
                        missile.y + missile.height > ufo.y &&
                        missile.x < ufo.x &&
                        missile.y < ufo.y
                    ){
                        ufo.hit = true; 
                        ufo.img.src = "img/explosion.png";
                        console.log("Collision!");
                        missiles = missiles.filter(u => u != missile);
                        ufos = ufos.filter(u => u != ufo);
                    }

                });
                });
            }

            

               

            function createUfos(){
                let ufo = {
                    x: 800,
                    y: Math.random()*500, 
                    width: 100, 
                    height: 40, 
                    src: "img/ufo.png",
                    img: new Image()
                };
                ufo.img.src = ufo.src;
                ufos.push(ufo);



            }

            function checkForShoot(){

                if (KEY_SPACE){
                    let missile = {
                        x: 150,
                        y: rocket.y - 25,
                        width: 50,
                        height: 100,
                        src: "img/missile.png",
                        img: new Image

                    };
                    missile.img.src = missile.src;
                    missiles.push(missile);
                }

                }

    
           
            function update(){

                if (KEY_UP){
                    rocket.y -= 10;
                }

                if (KEY_DOWN){
                    rocket.y += 10;

                
                }

                ufos.forEach(function(ufo){
                    ufo.x -= 10;
                })

                missiles.forEach(function(missile){
                    missile.x += 10;
                })
            }

            function loadImages(){

                backgroundImage.src = "img/sternenhimmel.jpg"
                rocket.img = new Image();
                rocket.img.src = rocket.src;
               
                
                

            }

            function draw(){
                ctx.drawImage(backgroundImage, 0, 0);
                ctx.drawImage(rocket.img, rocket.x, rocket.y, rocket.width, rocket.height);
              
                

                ufos.forEach(function(ufo){
                    ctx.drawImage(ufo.img, ufo.x, ufo.y, ufo.width, ufo.height);

                
                });
                missiles.forEach(function(missile){
                    ctx.drawImage(missile.img, missile.x, missile.y, missile.width, missile.height);
                });

               

                requestAnimationFrame(draw);

            }

    </script>
</head>
<body onload="startGame()"> 
    <canvas  id="canvas" width="720" height="480"></canvas>
</body>
</html>